{"componentChunkName":"component---src-templates-blog-post-js","path":"/projects/geomock.html","result":{"data":{"site":{"siteMetadata":{"title":"Jan Monschke","author":"Jan Monschke"}},"markdownRemark":{"id":"43236f10-6c7b-59e2-95cf-43d9d242aa61","excerpt":"Description  Developing Geo-aware Apps/Games can be such a pain in the ass. It can take ages until the device finally gets a decent signal or it’s raining…","html":"<h2>Description <a name=\"description\"></a></h2>\n<p>Developing Geo-aware Apps/Games can be such a pain in the ass.</p>\n<p>It can take ages until the device finally gets a decent signal or it’s raining outside and you don’t want to run around out in that bad weather to test your app or maybe you’re just too lazy to walk a mile or two ;)</p>\n<p>GeoMock can help in many ways when working with the Geolocation API:</p>\n<ul>\n<li>Predefined locations can fire up through the normal Geolocation API after a certain delay or even immediately</li>\n<li>It also allows you to define a set of waypoints that are being propagated through <code class=\"language-text\">geolocation.watchPosition</code>.</li>\n<li>It can be used to test the way your app behaves when no signal could be retrieved</li>\n</ul>\n<h2>TOC</h2>\n<ul>\n<li><a href=\"#usage\">Usage</a></li>\n<li><a href=\"#example\">Example</a></li>\n<li><a href=\"#dependencies\">Dependencies</a></li>\n<li><a href=\"#changelog\">Changelog</a></li>\n</ul>\n<h2>Usage <a name=\"usage\"></a></h2>\n<p>Simply include geomock.js in your website and it will replace the native Geolocation object. There is no need to change the API for tests because it mocks the Geolocation API.</p>\n<p>To retrieve a location user <code class=\"language-text\">navigator.geolocation.getCurrentPosition(success, error)</code> or <code class=\"language-text\">navigator.geolocation.watchPosition(success, error)</code>.</p>\n<p>The mock-locations can be changed by accessing the <code class=\"language-text\">navigator.geolocation.waypoints</code>-Array.</p>\n<p>The predefined delay is 1000ms. Change it like this <code class=\"language-text\">navigator.geolocation.delay = 2000;</code>.</p>\n<p>To test failing requests, set <code class=\"language-text\">navigator.geolocation.shouldFail</code> to <code class=\"language-text\">true</code>.</p>\n<h2>Example <a name=\"example\"></a></h2>\n<p>Simple watchPosition() demo (<a href=\"http://janmonschke.com/GeoMock/example.html\"><a href=\"http://janmonschke.com/GeoMock/example.html\">http://janmonschke.com/GeoMock/example.html</a></a>)</p>\n<p>The code for the example:</p>\n<div class=\"gatsby-highlight\" data-language=\"js\"><pre class=\"language-js\"><code class=\"language-js\">window<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">onload</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// setting up Google Maps</span>\n  <span class=\"token keyword\">var</span> latlng <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>LatLng</span><span class=\"token punctuation\">(</span>\n    navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span>waypoints<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">,</span>\n    navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span>waypoints<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>longitude\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> myOptions <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">zoom</span><span class=\"token operator\">:</span> <span class=\"token number\">18</span><span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">center</span><span class=\"token operator\">:</span> latlng<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">mapTypeId</span><span class=\"token operator\">:</span> google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>MapTypeId<span class=\"token punctuation\">.</span><span class=\"token constant\">ROADMAP</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> map_elem <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'map_canvas'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  map_elem<span class=\"token punctuation\">.</span>style<span class=\"token punctuation\">.</span>height <span class=\"token operator\">=</span> window<span class=\"token punctuation\">.</span>innerHeight <span class=\"token operator\">+</span> <span class=\"token string\">'px'</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> map <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>Map</span><span class=\"token punctuation\">(</span>map_elem<span class=\"token punctuation\">,</span> myOptions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">var</span> marker <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>Marker</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span> <span class=\"token literal-property property\">position</span><span class=\"token operator\">:</span> latlng <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  marker<span class=\"token punctuation\">.</span><span class=\"token function\">setMap</span><span class=\"token punctuation\">(</span>map<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token comment\">// GeoMock example code</span>\n  navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span>shouldFail <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">;</span>\n  navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span>delay <span class=\"token operator\">=</span> <span class=\"token number\">2000</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">basicSuccessHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">location</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Received a location:'</span><span class=\"token punctuation\">,</span> location<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    latlng <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">google<span class=\"token punctuation\">.</span>maps<span class=\"token punctuation\">.</span>LatLng</span><span class=\"token punctuation\">(</span>\n      location<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>latitude<span class=\"token punctuation\">,</span>\n      location<span class=\"token punctuation\">.</span>coords<span class=\"token punctuation\">.</span>longitude\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    map<span class=\"token punctuation\">.</span><span class=\"token function\">panTo</span><span class=\"token punctuation\">(</span>latlng<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    marker<span class=\"token punctuation\">.</span><span class=\"token function\">setPosition</span><span class=\"token punctuation\">(</span>latlng<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">var</span> <span class=\"token function-variable function\">basicErrorHandler</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">msg</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Geolocation error:'</span><span class=\"token punctuation\">,</span> msg<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n  navigator<span class=\"token punctuation\">.</span>geolocation<span class=\"token punctuation\">.</span><span class=\"token function\">watchPosition</span><span class=\"token punctuation\">(</span>basicSuccessHandler<span class=\"token punctuation\">,</span> basicErrorHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>Dependencies <a name=\"dependencies\"></a></h2>\n<p>none</p>\n<h2>Changelog <a name=\"changelog\"></a></h2>\n<ul>\n<li><strong>v1.0</strong>\n<ul>\n<li>initial version</li>\n<li>multiple waypoints</li>\n</ul>\n</li>\n</ul>","frontmatter":{"title":"Mock the Geolocation API","type":"project","date":null,"pomodoros":null,"keywords":null,"image":null}},"webmentions":{"edges":[]},"likes":{"edges":[]}},"pageContext":{"slug":"/projects/geomock.html","publicUrl":"https://janmonschke.com/projects/geomock.html"}},"staticQueryHashes":["1677560032","3729604799"]}