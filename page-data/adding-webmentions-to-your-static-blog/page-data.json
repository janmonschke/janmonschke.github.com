{"componentChunkName":"component---src-templates-blog-post-js","path":"/adding-webmentions-to-your-static-blog","result":{"data":{"site":{"siteMetadata":{"title":"Jan Monschke","author":"Jan Monschke"}},"markdownRemark":{"id":"ca7a4809-6b07-568e-8b71-bf4d978dbfa4","excerpt":"This blog used to have comments. There was a time when you could find a comment form under each post. The form was provided through a third-party embed of‚Ä¶","html":"<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/42e16455d593291331762856f5557ac3/1fe05/webmentions_header_alternative.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 52.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAQBAgP/xAAXAQADAQAAAAAAAAAAAAAAAAABAgME/9oADAMBAAIQAxAAAAHaKJZrujAh/8QAGhAAAgMBAQAAAAAAAAAAAAAAAQIAEiEiEf/aAAgBAQABBQK/VxCB62Kh7XZ//8QAFxEBAAMAAAAAAAAAAAAAAAAAABESUf/aAAgBAwEBPwGuof/EABcRAQADAAAAAAAAAAAAAAAAAAABEjH/2gAIAQIBAT8BjF3/xAAbEAEBAAEFAAAAAAAAAAAAAAABABECEBIxcf/aAAgBAQAGPwIJDueQ59tOzm//xAAaEAEAAgMBAAAAAAAAAAAAAAABABEhMUFx/9oACAEBAAE/IUBrRx5LEOkoVFBKHGMKnk2sm5//2gAMAwEAAgADAAAAEB8//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/EMaRd//EABcRAQEBAQAAAAAAAAAAAAAAAAEAETH/2gAIAQIBAT8QWpLB2//EAB0QAQEAAgIDAQAAAAAAAAAAAAERACExQWFxkbH/2gAIAQEAAT8QTFdNKjnC0cNvVZhSRJpR0N17yRpwfMtga/rnAjsJ4M//2Q=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/42e16455d593291331762856f5557ac3/507e6/webmentions_header_alternative.webp 200w,\n/static/42e16455d593291331762856f5557ac3/28a80/webmentions_header_alternative.webp 400w,\n/static/42e16455d593291331762856f5557ac3/8d2ea/webmentions_header_alternative.webp 800w,\n/static/42e16455d593291331762856f5557ac3/6c7d1/webmentions_header_alternative.webp 960w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/42e16455d593291331762856f5557ac3/37402/webmentions_header_alternative.jpg 200w,\n/static/42e16455d593291331762856f5557ac3/4cda9/webmentions_header_alternative.jpg 400w,\n/static/42e16455d593291331762856f5557ac3/c60e9/webmentions_header_alternative.jpg 800w,\n/static/42e16455d593291331762856f5557ac3/1fe05/webmentions_header_alternative.jpg 960w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/jpeg\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/42e16455d593291331762856f5557ac3/c60e9/webmentions_header_alternative.jpg\"\n            alt=\"webmentions header alternative\"\n            title=\"webmentions header alternative\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>This blog used to have comments. There was a time when you could find a comment form under each post. The form was provided through a third-party embed of course, since this is a static site. There is no server or no database that could hold on to your comments.</p>\n<p>After a couple of years I decided to remove the comment form since it wasn‚Äôt really used and most discussions happened on social media anyways. Sadly there was no (sensible / easy) way to bring those discussion here without embedding tons of external code.</p>\n<p>But when I was reading <a href=\"https://localghost.dev/blog/2022-the-year-in-lists/\">Sophie‚Äôs</a> and <a href=\"https://andy-bell.co.uk/wrapping-up-2022/\">Andy‚Äôs</a> blog posts, I noticed that they contained comments and likes from social media sites without a third-party embed. So I went on a journey to understand how that integration works and how to bring it to my own blog as well.</p>\n<h2>What are webmentions?</h2>\n<p>These blogs are using <a href=\"https://en.wikipedia.org/wiki/Webmention\">webmentions</a> to gather mentions/likes/reposts from all over the internet. Webmentions are a (recommended) standard that allows sites to notify other sites that they‚Äôre linking to them.</p>\n<div style=\"width: 60%; margin: 0 auto;\">\n<p><img src=\"/26d947f0bdd8ec15308b6081c2f9720b/webmentions_diagram.svg\" alt=\"Site A publishes a blog post mentioning your site. This generates a webmention.\"></p>\n</div>\n<p>The way this works is that site A defines a <code class=\"language-text\">webmention</code> API endpoint as a <code class=\"language-text\">&lt;link /></code> and site B, e.g. when a new blog post is created, looks at its external links, checks if they support webmentions and when they do, calls their webmention endpoint. That call contains the source of the link and the type of that link amongst more metadata like the date (types will be explained later).</p>\n<p>Webmentions are a great system, but they do not really work for static sites like this one. There is no server, so no webmention endpoint. Luckily, there are services that will collect webmentions on your behalf so you can fetch them later on. One of those services is <a href=\"https://webmention.io\">webmention.io</a>.</p>\n<h3>webmention.io</h3>\n<p>After signing up on the site, it provides you with a webmention endpoint that you can add to your site:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>webmention<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>https://webmention.io/janmonschke.com/webmention<span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>Add that to your site‚Äôs <code class=\"language-text\">&lt;head/></code> and other sites can immediately start sending mentions of your site to webmention.io.</p>\n<p><img src=\"/0c747f7efd9aa0b516aa638b98953ece/webmention_io_diagram.svg\" alt=\"webmention.io collects webmentions for your site from external sites\"></p>\n<p>The collected webmentions can be queried through webmention.io‚Äôs API. And when there‚Äôs an API, there‚Äôs a way to embed those mentions onto my blog. That‚Äôs great!</p>\n<p>But! <em>There had to be a but, of course.</em></p>\n<p>My initial problem was that discussions were happening on social media. Social media sites do sadly not send webmentions. Neither Twitter, nor Mastodon<sup id=\"fnref-1\"><a href=\"#fn-1\" class=\"footnote-ref\">1</a></sup>. So how do the sites mentioned above get their likes and mentions from social media?</p>\n<h3>brid.gy</h3>\n<p>Of course there is another service that solves this problem: <a href=\"https://brid.gy/\">brid.gy</a></p>\n<p><img src=\"/405b8eedfa13ddf24b98b87c591e0fb8/bridgy_diagram.svg\" alt=\"Bridgy sits in between social media sites and your webmentions\"></p>\n<p>Brid.gy connects mentions, likes, reposts etc. from social media sites to your site. It basically works as an automated social media search for mentions for your site and it then converts those mentions / reactions into webmentions.</p>\n<div style=\"width: 60%; margin: 0 auto;\">\n<p><img src=\"/4627032ef666b1cca642659819db2806/bridgy_site_crawl_diagram.svg\" alt=\"Bridgy crawls your site for mentions of other sites that use webmentions\"></p>\n</div>\n<p>Even better, brid.gy also acts as webmention ‚Äúnotifier‚Äù for your site. It periodically crawls your site for mentions of other sites and it will then create webmentions for those sites. It‚Äôs such a helpful service. This allows static sites to act like proper players in the webmention/indieweb game.</p>\n<p>A final cool feature, and I promise I will then stop praising brid.gy so much. Brid.gy can also scan your old social media posts and create mentions for those. Meaning you can collect likes as webmentions from previously when you weren‚Äôt using brid.gy and webmention.io yet. Backfeeding of mentions is limited to likes and reposts though<sup id=\"fnref-2\"><a href=\"#fn-2\" class=\"footnote-ref\">2</a></sup>.</p>\n<h2>Bringing webmentions to your static site</h2>\n<p>Now, how are we going to bring webmentions to our static site? There are two ways of how to use webmentions in your static site that I will explain in this post.</p>\n<p>The first one is the simplest one and, apart from setting up webmention.io and brid.gy, requires pretty much no extra setup. The second one is a bit more involved and requires GitHub actions, a proper integration into Gatsby‚Äôs GraphQL layer and, optionally, setting up a webhook for your Github actions (most of that flow will also work for other static site generators).</p>\n<p>The first approach is perfect for your if you quickly want to see how webmentions will look like on your site. However, I recommend going with the second approach (if possible). It has the advantage of owning your mentions. It‚Äôs more resilient to outages and shutdowns of the third-party sites you rely on and your site will load faster. It is also more flexible, as we‚Äôll see later on.</p>\n<h3>Fetching webmentions on-demand</h3>\n<p>The simplest way to show webmentions is to fetch them on the client-side from webmention.io.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">function</span> <span class=\"token function\">Webmentions</span><span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> postUrl <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>mentions<span class=\"token punctuation\">,</span> setMentions<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token function\">useState</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token string\">'https://webmention.io/api/mentions.jf2?target='</span> <span class=\"token operator\">+</span> postUrl<span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">response</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> response<span class=\"token punctuation\">.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mentionsJson</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token function\">setMentions</span><span class=\"token punctuation\">(</span>mentionsJson<span class=\"token punctuation\">.</span>children<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>mentions <span class=\"token operator\">||</span> mentions<span class=\"token punctuation\">.</span>length <span class=\"token operator\">===</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>\n    <span class=\"token operator\">&lt;</span>aside<span class=\"token operator\">></span>\n      <span class=\"token operator\">&lt;</span>ul<span class=\"token operator\">></span>\n        <span class=\"token punctuation\">{</span>mentions\n          <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">wm</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span>\n            <span class=\"token punctuation\">[</span><span class=\"token string\">'in-reply-to'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mention-of'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>wm<span class=\"token punctuation\">[</span><span class=\"token string\">'wm-property'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">mention</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">(</span>\n            <span class=\"token operator\">&lt;</span>li key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>mention<span class=\"token punctuation\">.</span>id<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n              @<span class=\"token punctuation\">{</span>mention<span class=\"token punctuation\">.</span>author<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">}</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>mention<span class=\"token punctuation\">.</span>content<span class=\"token punctuation\">.</span>text<span class=\"token punctuation\">}</span>\n            <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>li<span class=\"token operator\">></span>\n          <span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n      <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>ul<span class=\"token operator\">></span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>aside<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This piece of code<sup id=\"fnref-3\"><a href=\"#fn-3\" class=\"footnote-ref\">3</a></sup> will render a list of all webmentions for the given post on your site. Each mention will contain the user‚Äôs name and their message like so:</p>\n<p><em>@Jeremy: I found this really cool blog post by Ada adas.site/webmentions-explained</em></p>\n<p>The webmention object has a lot more properties that we are not using in this example but you might want to check them out for your use-case (e.g. a link back to the author at <code class=\"language-text\">author.url</code>, the author‚Äôs profile pic <code class=\"language-text\">author.photo</code> or a link back to the original post <code class=\"language-text\">mention.url</code>).</p>\n<p>This component can be placed anywhere on a blog post or any other site. Its only parameter is <code class=\"language-text\">postUrl</code> which is the public url of the page you want to fetch webmentions for (e.g. <code class=\"language-text\">https://adas.site/webmentions-explained/</code>). This url is the one that you or other users post on social media or their webmention-enabled blog. <strong>Brid.gy</strong> and <strong>webmention.io</strong> will use that public url to send and store your mentions.</p>\n<p>If we have another look at where the code iterates over the mentions, you‚Äôll find that we are filtering the mentions based on their <code class=\"language-text\">wm-property</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">mentions\n  <span class=\"token punctuation\">.</span><span class=\"token function\">filter</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">wm</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string\">'in-reply-to'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'mention-of'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">includes</span><span class=\"token punctuation\">(</span>wm<span class=\"token punctuation\">[</span><span class=\"token string\">'wm-property'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">)</span></code></pre></div>\n<p>We are doing this in order to only show replies or mentions of our post. Other types of webmentions do not include <code class=\"language-text\">content</code>, so the code above would not work. Other types include <code class=\"language-text\">like-of</code> for likes of your post and <code class=\"language-text\">repost-of</code> for reposts of your post. A full list of the supported values of <code class=\"language-text\">wm-property</code> can be found in the <a href=\"https://github.com/aaronpk/webmention.io#find-links-of-a-specific-type-to-a-specific-page\">webmention.io documention</a>.</p>\n<p>It is generally a good idea to group webmentions by type and show them in distinct lists. For example a simpler list of likes and more complex list for actuall mentions with content. But feel free to integrate all types in the same list. There are no rules and the world is your oyster!</p>\n<p>This approach is pretty simple but has some disadvantages:</p>\n<ul>\n<li>It makes an extra request for each user visiting the page</li>\n<li>When webmention.io is down, your mentions (and likes etc.) won‚Äôt load</li>\n<li>In case webmention.io shuts down, you lose all your webmentions</li>\n</ul>\n<h3>Owning your webmentions and building them statically</h3>\n<p>The approach that I took for webmentions on this site makes sure that webmentions are checked into GitHub. This makes them resilient to issues with third-party webmention providers and it allows to build them statically. Meaning we don‚Äôt need to make an additional request, yay üéâ</p>\n<blockquote>\n<p>This approach is influenced by <a href=\"https://sebastiandedeyne.com/webmentions-on-a-static-site-with-github-actions/\">Sebastian De Deyne‚Äôs webmention integration</a>. Instead of integrating webmentions into Hugo, I‚Äôm explaining here how to integrate them into Gatsby. There are already Gatsby plugins for webmentions but they load them dynamically and not statically.</p>\n</blockquote>\n<h4>Synchronizing webmentions into your GitHub repository</h4>\n<p>Similarly to the first approach, we need to fetch webmentions from webmention.io. This time however, we are going to sync all mentions for our domain, instead of mentions per post/site. We could do it per post, but I find Sebastian‚Äôs solution quite elegant, so we‚Äôll stick to it.</p>\n<p>The synchronization works like this:</p>\n<ol>\n<li>Fetch all mentions for our domain (in my case <a href=\"https://janmonschke.com\">https://janmonschke.com</a>)</li>\n<li>For each webmention, we will read out it‚Äôs <code class=\"language-text\">wm-target</code> property</li>\n<li>Check in <code class=\"language-text\">./webmentions/data/</code> if we already have a JSON webmention file for that post (e.g. <code class=\"language-text\">webmentions-explained.json</code>)</li>\n<li>If the file exists, then merge the new mention into that file\n<ol>\n<li>Make sure to exclude duplicates by comparing the <code class=\"language-text\">wm-id</code> property üîé</li>\n<li>Sort mentions by <code class=\"language-text\">wm-id</code> to keep a roughly correct order in the cache file. The actual order for mentions will be based on the <code class=\"language-text\">published</code> property later on. However, likes and reposts don‚Äôt have this property, so <code class=\"language-text\">wm-id</code> is the best we can do at this point. ‚úÖ</li>\n<li>Write the file to disk üéâ</li>\n</ol>\n</li>\n<li>If the file does not exist, create a new cache file for this post which only contains this webmention: <code class=\"language-text\">[webmention]</code> üéâ</li>\n</ol>\n<p>You can check out the code below or directly in my <a href=\"https://github.com/janmonschke/janmonschke.github.com/blob/dev/webmentions/sync.js\">site‚Äôs GitHub repo</a>.</p>\n<iframe\nsrc=\"https://gist.github.com/janmonschke/49d354bc96393348a9037dba0018fa6b.pibb\"\nstyle=\"width: 100%; height: 300px; border: 0;margin-top: -1.5em;\">\n</iframe>\n<p>I found that a good directory for the JSON files is <code class=\"language-text\">./webmentions/data</code> since my sync script lives in <code class=\"language-text\">./webmentions/sync.js</code>. First I tried to co-locate blog posts and their webmentions cache in the same but it turned out to be quite complicated to find the correct directory based on the <code class=\"language-text\">wm-target</code> property. I could parse those urls and then also parse all my post‚Äôs frontmatter to try and match them but there is an easier way to associate mentions and posts and that is GraphQL.</p>\n<p>One optimization for the synchronization flow is to not always fetch all webmentions. If you regularly sync your mentions, you can use the <code class=\"language-text\">since</code> parameter in the webmention.io API in order to limit the timeframe for new mentions.</p>\n<h4>Sourcing webmentions into Gatsby‚Äôs GraphQL layer</h4>\n<p>Now that we have the mentions in our repository, we want to tell Gatsby to ingest them so we can query them via GraphQL. For that we need to install <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-transformer-json#readme\">gatsby-transformer-json</a> and <a href=\"https://github.com/gatsbyjs/gatsby/tree/master/packages/gatsby-source-filesystem#readme\">gatsby-source-filesystem</a>.</p>\n<p>In the <code class=\"language-text\">gatsby-config.js</code> we then set up the plugins like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token literal-property property\">plugins</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-transformer-json</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">typeName</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">webmentions</span><span class=\"token template-punctuation string\">`</span></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n<span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">resolve</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">gatsby-source-filesystem</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">options</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>__dirname<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">/webmentions/data</span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p><code class=\"language-text\">gatsby-source-filesystem</code> tells Gatsby to source files from <code class=\"language-text\">${__dirname}/webmentions/data</code> and <code class=\"language-text\">gatsby-transformer-json</code> parses the JSON content from those files and makes the webmentions available via GraphQL.</p>\n<p>In GraphiQL, we now have access to a new entry for <code class=\"language-text\">allWebmentions</code> which contains the content of all the sourced JSON files.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/85e651266c630d7d83048d9bd7b024e0/f866a/graphiql.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 68%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAAsTAAALEwEAmpwYAAABqUlEQVQoz32R647cIAyF8/5Pud3tTEJCMOAblwBVpjPZUbWqdcQvf/j4eJJUHPje+xjD2v3z42MzZrfbbs/ats1aOy+LAwfgnYO/Wrd9MXYSquNVOSWwEPYopUqprbUxRmst+rhu3iOz6Lsm5HLBKankajHVox0PL2OM3jshzQYAMGkSSaJZNImmaQN8tQ1V7a0FzvVo14+9dyamyLebi6unLXDkJzzvsbYnLSLHcaA+4H5yo/XeO9qAM5i7CzPgp8Wbw8Wzp8l6Ol6wqpRSKNWstWpr+ehSjlzJRdyCd5EB6RSRjRx4WoBKa9fkUr4jeLeNgX5/WfdrQQO0BjSeNU1mw8THaa+2nHJr7QeYJSL7QBRIUISTsJ47O0MSSsu1csop9Su9dzhS2KMxwB4ZkFkln4FPe5SrvZTy4+RzTxtvdwhboBlw8wTEpNPNYpTyP3icacebc6tH89DiaYYzbQN8XbWUchzHP85P28gIZO4OF0d7ZCD2dNpO5XtUKeXHnQlinMF+7d44hsgkz8Bs1KtPVdd1vd/nGGPOOT1KVUkkiDpkSemUPt8/fuoqHsQ4KJQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/85e651266c630d7d83048d9bd7b024e0/507e6/graphiql.webp 200w,\n/static/85e651266c630d7d83048d9bd7b024e0/28a80/graphiql.webp 400w,\n/static/85e651266c630d7d83048d9bd7b024e0/8d2ea/graphiql.webp 800w,\n/static/85e651266c630d7d83048d9bd7b024e0/68fc1/graphiql.webp 1200w,\n/static/85e651266c630d7d83048d9bd7b024e0/43d96/graphiql.webp 1600w,\n/static/85e651266c630d7d83048d9bd7b024e0/d7140/graphiql.webp 2458w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/85e651266c630d7d83048d9bd7b024e0/36ca5/graphiql.png 200w,\n/static/85e651266c630d7d83048d9bd7b024e0/a3397/graphiql.png 400w,\n/static/85e651266c630d7d83048d9bd7b024e0/a331c/graphiql.png 800w,\n/static/85e651266c630d7d83048d9bd7b024e0/8537d/graphiql.png 1200w,\n/static/85e651266c630d7d83048d9bd7b024e0/1a152/graphiql.png 1600w,\n/static/85e651266c630d7d83048d9bd7b024e0/f866a/graphiql.png 2458w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/85e651266c630d7d83048d9bd7b024e0/a331c/graphiql.png\"\n            alt=\"Screenshot of GraphiQL showing the new entry for allWebmentions\"\n            title=\"Screenshot of GraphiQL showing the new entry for allWebmentions\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>If we wanted to fetch all webmentions of our site, we could use the following query:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Webmentions</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token object\">allWebmentions</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token object\">edges</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token object\">node</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">id</span>\n        <span class=\"token object\">author</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">name</span>\n          <span class=\"token property\">photo</span>\n          <span class=\"token property\">url</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token object\">content</span> <span class=\"token punctuation\">{</span>\n          <span class=\"token property\">text</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token property\">url</span>\n        <span class=\"token property-query\">published</span><span class=\"token punctuation\">(</span><span class=\"token attr-name\">formatString</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"YYYY/MM/DD hh:mm\"</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This would return information on each webmention‚Äôs user, it‚Äôs content, the url it came from and the date it was published at. The JSON transformer even managed to deduct the correct type for the <code class=\"language-text\">published</code> field. Since it detected a <code class=\"language-text\">Date</code> type, we can use the <code class=\"language-text\">formatString</code> transform to get a preformatted date string üìÜ.</p>\n<h4>Querying and displaying webmentions for your blog post</h4>\n<p>It‚Äôs nice to have all webmentions for our site, but a more practical query is to ask for mentions of a specific post on our site. For that, we‚Äôll filter webmentions by their <code class=\"language-text\">wm_target</code> property. <code class=\"language-text\">wm_target</code> is the public url of the post.</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Webmentions</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property-query\">allWebmentions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token attr-name\">wm_target</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$publicUrl</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token attr-name\">sort</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token property\">published</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">order</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">ASC</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>At the same time, we can also use the <code class=\"language-text\">published</code> property to sort the posts by their publishing date. The <code class=\"language-text\">$publicUrl</code> variable we can pass to Gatsby‚Äôs <code class=\"language-text\">createPage</code> function like this:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">{</span> slug <span class=\"token punctuation\">}</span> <span class=\"token operator\">=</span> post<span class=\"token punctuation\">.</span>node<span class=\"token punctuation\">.</span>fields<span class=\"token punctuation\">;</span>\n<span class=\"token function\">createPage</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">path</span><span class=\"token operator\">:</span> slug<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">component</span><span class=\"token operator\">:</span> blogPost<span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">context</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">publicUrl</span><span class=\"token operator\">:</span> <span class=\"token function\">ensureTrailingSlash</span><span class=\"token punctuation\">(</span><span class=\"token constant\">YOUR_DOMAIN</span> <span class=\"token operator\">+</span> slug<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>I noticed that all <code class=\"language-text\">wm_target</code> values have a trainling slash, but only some of the <code class=\"language-text\">slug</code>s did, so I made a little helper function (<code class=\"language-text\">ensureTrailingSlash</code>) that appends a slash in case the slug doesn‚Äôt have one.</p>\n<p>Now there is only one more filter missing. If you‚Äôve read the first part about fetching webmentions dynamically, you might remember that we‚Äôre now also receiving like- and repost-mentions of our post. Those lack some properties such as <code class=\"language-text\">content</code> and <code class=\"language-text\">published</code> which is why we filtered them out previously. We can achieve the same thing in GraphQL:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Webmentions</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$publicUrl</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">webmentions</span><span class=\"token punctuation\">:</span> <span class=\"token property-query\">allWebmentions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token attr-name\">wm_property</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">in</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"in-reply-to\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"mention-of\"</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">}</span>\n      <span class=\"token attr-name\">wm_target</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$publicUrl</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token attr-name\">sort</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">fields</span><span class=\"token punctuation\">:</span> <span class=\"token property\">published</span><span class=\"token punctuation\">,</span> <span class=\"token attr-name\">order</span><span class=\"token punctuation\">:</span> <span class=\"token constant\">ASC</span> <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This will only return replies and mentions of our post and it will allow us to display a list of webmentions. On my blog, I‚Äôm rendering the webmentions like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1b8a17dcfcccdc1874a9fb91cc04ae78/7608f/list_of_webmentions.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 92%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAACBElEQVQ4y5WTS4vVMBiG+3cFV4K4cSGKC0HdKW4UxaUwK3+EgiAu5ng6Pee0yUnaXNum9+ZWaXsGZhgZZh5ScvnyJu/XJEEYhuF2m8SxNWaaJu/9dIW16y+ZrhP8/v452v7MGgeLgdT6pv6/rHOCl08efvzwJlb2Lx8SIrMsY4wJITjnjDHOuZSSMUYpJYQIIRhjUsqqqmbxulLembTSvBkHbZxzdmGt3SVX2yfbu2hz2IeDvYPXGwSPHz148fwpqixrTNXrqqrqulZKVXXdq9xbfZt4szmPoggrvaH9QfaFUlWlyoWxb6dbDZ1y1taP1pl7mg/+/PoB9hdinELe89beL+fdxR4d06MaI96ClKYYQwjTBbSwNgAAeAkhhDDGcRxTSoP1xCnJUHIoBS1LJYTI87wsSyllURRKqaIoOOdKzaGiKMRC0zSnnFnZQpqX7eDuZdtaY61pja+1b7Rzd76bs/j1q2fv372lrdduHnLOuzk4f+tKbnkRzi/jl7LT3f765dPZ2bdEtue4jBCH8T5DkKQIxAd8BDA5YAhgEtMMZwimGAMAhBDXzpmSDB9BkvEDVVskdlm+S/MozS9SGWK5S0WIxBbn4IghABBCKWXf98HyBAwhlGQEEc5V12jfjL6ei1tLo+euGlzXD+Mw9P3QdZ0x5rQzUR0QTZo346jv/rf/AaSHAs7HExoRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/1b8a17dcfcccdc1874a9fb91cc04ae78/507e6/list_of_webmentions.webp 200w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/28a80/list_of_webmentions.webp 400w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/8d2ea/list_of_webmentions.webp 800w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/68fc1/list_of_webmentions.webp 1200w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/7f4dd/list_of_webmentions.webp 1426w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/1b8a17dcfcccdc1874a9fb91cc04ae78/36ca5/list_of_webmentions.png 200w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/a3397/list_of_webmentions.png 400w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/a331c/list_of_webmentions.png 800w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/8537d/list_of_webmentions.png 1200w,\n/static/1b8a17dcfcccdc1874a9fb91cc04ae78/7608f/list_of_webmentions.png 1426w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/1b8a17dcfcccdc1874a9fb91cc04ae78/a331c/list_of_webmentions.png\"\n            alt=\"A screenshot of the list of webmentions\"\n            title=\"A screenshot of the list of webmentions\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>As an example, check out how I‚Äôm rendering mentions on my site: <a href=\"https://github.com/janmonschke/janmonschke.github.com/blob/4413146f9d5b9ebfe73f2b7d4b9aeae0ff2e7349/src/components/Mentions.js\">Mentions.js</a>.</p>\n<p>If you want to show likes and reposts of your posts as well, you can use the following query to also select those:</p>\n<div class=\"gatsby-highlight\" data-language=\"graphql\"><pre class=\"language-graphql\"><code class=\"language-graphql\"><span class=\"token keyword\">query</span> <span class=\"token definition-query function\">Webmentions</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$publicUrl</span><span class=\"token punctuation\">:</span> <span class=\"token scalar\">String</span><span class=\"token operator\">!</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token attr-name\">likes</span><span class=\"token punctuation\">:</span> <span class=\"token property-query\">allWebmentions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token attr-name\">wm_property</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"like-of\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token attr-name\">wm_target</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$publicUrl</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token attr-name\">reposts</span><span class=\"token punctuation\">:</span> <span class=\"token property-query\">allWebmentions</span><span class=\"token punctuation\">(</span>\n    <span class=\"token attr-name\">filter</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token attr-name\">wm_property</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"repost-of\"</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token attr-name\">wm_target</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span> <span class=\"token attr-name\">eq</span><span class=\"token punctuation\">:</span> <span class=\"token variable\">$publicUrl</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">(</span><span class=\"token operator\">...</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And then you can display them in your blog post as well.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bacedeca136b545605b6812deacceeed/ff5cf/likes.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAIAAAAcOLh5AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAlElEQVQI153BTQuCMBgA4P36bjt0jSCrS0SEE1HfqSs3XDY/MiUXnRoRXTpKR+s/9DzIGKP1dRi+f0DnUuZHZUNm7k/wAGO8XFg+2bTS7z99U5djPGIQZTzp348dXXdt8bqpPMy6UiORRGLPXMeVrPAJBBSqlPM42K6spq1EwmeTeeyQ2LFrlUpBKxke7Gnghaf88gOUzZTnrswBzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/bacedeca136b545605b6812deacceeed/507e6/likes.webp 200w,\n/static/bacedeca136b545605b6812deacceeed/28a80/likes.webp 400w,\n/static/bacedeca136b545605b6812deacceeed/8d2ea/likes.webp 800w,\n/static/bacedeca136b545605b6812deacceeed/68fc1/likes.webp 1200w,\n/static/bacedeca136b545605b6812deacceeed/5cc32/likes.webp 1300w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/bacedeca136b545605b6812deacceeed/36ca5/likes.png 200w,\n/static/bacedeca136b545605b6812deacceeed/a3397/likes.png 400w,\n/static/bacedeca136b545605b6812deacceeed/a331c/likes.png 800w,\n/static/bacedeca136b545605b6812deacceeed/8537d/likes.png 1200w,\n/static/bacedeca136b545605b6812deacceeed/ff5cf/likes.png 1300w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/bacedeca136b545605b6812deacceeed/a331c/likes.png\"\n            alt=\"A screenshot of the likes on my blog post\"\n            title=\"A screenshot of the likes on my blog post\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>This is the code I use for my likes for example: <a href=\"https://github.com/janmonschke/janmonschke.github.com/blob/4413146f9d5b9ebfe73f2b7d4b9aeae0ff2e7349/src/components/Likes.js\">Likes.ts</a>. I haven‚Äôt really felt the need yet to show reposts as well.</p>\n<h4>Sanitizing the external html content</h4>\n<p>Let‚Äôs have a last look at the <code class=\"language-text\">content</code> of a webmention. In the previous examples, I only queried for <code class=\"language-text\">content.text</code> which does not actually contain links to profiles but only a raw text representation of a webmention. That means @mentions in the content are neither highlighted, nor are they interactive.</p>\n<p>There is a <code class=\"language-text\">content.html</code> version that does contain links to profiles and proper <code class=\"language-text\">&lt;a/></code> tags for external links. However, it also contains more unwanted HTML like <code class=\"language-text\">&lt;p/></code> tags around the text. More importantly, the HTML could potentially contain harmful elements (think: script injection).</p>\n<p>Just showing the raw text was not an option for me, neither was embedding the external HTML. So I decided to parse <code class=\"language-text\">content.html</code> for links to profiles and other resources. And then use that information to enrich the raw text from <code class=\"language-text\">content.text</code>.</p>\n<p>First, we‚Äôre parsing the HTML for @mentions and their links:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> atMentionUrlRegex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">&lt;a href=\"([http].+?)\".+?class=\\\"u-url\\\">(.*?)&lt;\\/a></span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Create a lookup for @mention links e.g.:</span>\n<span class=\"token comment\">// { \"@janmon\": \"https://social.lol/janmon\" }</span>\n<span class=\"token keyword\">const</span> atMentionsUrls <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token operator\">...</span>html<span class=\"token punctuation\">.</span><span class=\"token function\">matchAll</span><span class=\"token punctuation\">(</span>atMentionUrlRegex<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span><span class=\"token function\">reduce</span><span class=\"token punctuation\">(</span>\n  <span class=\"token punctuation\">(</span><span class=\"token parameter\">_atMentions<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span>_<span class=\"token punctuation\">,</span> userUrl<span class=\"token punctuation\">,</span> userAtMention<span class=\"token punctuation\">]</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    _atMentions<span class=\"token punctuation\">[</span>userAtMention<span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;span>'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span><span class=\"token string\">'&lt;/span>'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">''</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span>\n      userUrl<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> _atMentions<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>This will allow us to replace raw @mentions e.g. <code class=\"language-text\">@janmon</code> with proper <code class=\"language-text\">&lt;a/></code> tags in the next step.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> atMentionRegex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(@\\w+)</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> urlRegex <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">(https|http):\\/\\/\\S+</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">g</span></span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">const</span> enhancedText <span class=\"token operator\">=</span> text\n  <span class=\"token comment\">// Replace all @mentions with links nofollow + ugc links that were parsed before</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>atMentionRegex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">atMention</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;a href=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>atMentionsUrls<span class=\"token punctuation\">[</span>atMention<span class=\"token punctuation\">]</span><span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" rel=\"nofollow ugc\" target=\"_blank\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>atMention<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/a></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">// Replace all urls in the text with nofollow + ugc links</span>\n  <span class=\"token punctuation\">.</span><span class=\"token function\">replace</span><span class=\"token punctuation\">(</span>urlRegex<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">url</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">&lt;a href=\"</span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">\" rel=\"nofollow ugc\" target=\"_blank\"></span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>url<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token string\">&lt;/a></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>In the first step, we‚Äôre using a regular expression that matches @mentions to replace the mention with a normal link. I also decided to add <a href=\"http://developer.mozilla.org/docs/Web/HTML/Link_types\">rel=‚Äúnofollow ugc‚Äù</a> to the link since they are indeed user-generated and I do not have control over to where they link to.</p>\n<p>In the second step, we‚Äôre replacing raw urls (identified by starting with either <code class=\"language-text\">http</code> or <code class=\"language-text\">https</code>) with regular link tags as well. Same procedure, really.</p>\n<p>The resulting text feels ‚Äúsafe‚Äù enough for me to then render it in a <code class=\"language-text\">dangerouslySetInnerHTML</code> üòÖ. This allows me to render webmentions with interactive @mentions and links üéâ <sup id=\"fnref-4\"><a href=\"#fn-4\" class=\"footnote-ref\">4</a></sup>.</p>\n<p>The actual code on my site contains some more documentation around the expected shape of the HTML content. Check out my <a href=\"https://github.com/janmonschke/janmonschke.github.com/blob/4413146f9d5b9ebfe73f2b7d4b9aeae0ff2e7349/src/components/Mentions.js#L46-L102\">Mentions component</a> if you want to dive deeper into this function.</p>\n<h3>Automating the webmention synchronisation</h3>\n<p>The final bit of the webmention integration is to automate the entire process. If you‚Äôre okay with running the script yourself every now and then that is also totally fine. The automation is totally optional.</p>\n<p>Since I‚Äôm using GitHub to host my blog and its code, I‚Äôm also using GitHub actions to automate fetching webmentions. Prior knowledge with GitHub actions is not required for this step of the process. I‚Äôm giving a basic description of most of the instructions but am not going into a lot of detail.</p>\n<p>The game plan for the automation is to be able to run the synchronization periodically, in response to a webhook from webmention.io and when triggered manually (which is useful for debugging).</p>\n<p>As before, I‚Äôm using <a href=\"https://sebastiandedeyne.com/webmentions-on-a-static-site-with-github-actions/\">Sebastian‚Äôs setup</a> as the base for my own integration.</p>\n<p>Let‚Äôs go ahead and create a new workflow file in <code class=\"language-text\">.github/workflows</code>. Let‚Äôs call it <code class=\"language-text\">webmention-sync.yml</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Webmentions Sync\n\n<span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0 */24 * * *'</span>\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\n\n<span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  webmentions<span class=\"token punctuation\">-</span>sync<span class=\"token punctuation\">:</span></code></pre></div>\n<p>This part of the workflow file defines our new workflow <code class=\"language-text\">Webmentions Sync</code> wich will run periodically every 24 hours at midnight (<code class=\"language-text\">cron</code>) and it has a manual trigger in the GitHub UI (<code class=\"language-text\">workflow_dispatch</code>). The actual instructions it will execute are defined in the <code class=\"language-text\">jobs</code> section. Since we only run one job that is made of several steps, we‚Äôre only using one top level key here <code class=\"language-text\">webmentions-sync</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">jobs</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">webmentions-sync</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">runs-on</span><span class=\"token punctuation\">:</span> ubuntu<span class=\"token punctuation\">-</span>latest\n    <span class=\"token key atrule\">steps</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Check out repository\n        <span class=\"token key atrule\">uses</span><span class=\"token punctuation\">:</span> actions/checkout@v3\n        <span class=\"token key atrule\">with</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">ref</span><span class=\"token punctuation\">:</span> dev\n          <span class=\"token key atrule\">token</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.GH_PAGES_ACCESS_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Sync webmentions\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">WEBMENTIONS_IO_TOKEN</span><span class=\"token punctuation\">:</span> $<span class=\"token punctuation\">{</span><span class=\"token punctuation\">{</span> secrets.WEBMENTIONS_IO_TOKEN <span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> node ./webmentions/sync.js\n      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> Commit to repository\n        <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">COMMIT_MSG</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n            Sync webmentions</span>\n        <span class=\"token key atrule\">run</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\">\n          git config user.email \"YOUR_GITHUB_EMAIL\"\n          git config user.name \"THE_NAME_YOU_WANT_TO_ASSOCIATE_TO_THE_COMMIT\"\n          git add .\n          git diff --quiet &amp;&amp; git diff --staged --quiet || (git commit -m \"${COMMIT_MSG}\"; git push origin dev)</span></code></pre></div>\n<p>In the first step we‚Äôre using the <code class=\"language-text\">actions/checkout</code> action to check out the current repository on the CI. This is an external action that is provided by GitHub. We‚Äôre checking out the <code class=\"language-text\">dev</code> branch and passing a custom <code class=\"language-text\">token</code>. <code class=\"language-text\">secrets.GH_PAGES_ACCESS_TOKEN</code> is a personal access token the script needs in order to commit to your repository with a token that is not the standard action token. Check out <a href=\"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token\">this guide on how to create a token on GitHub</a>. A different token is needed here since only a custom token will trigger the action workflow that will actually build the site<sup id=\"fnref-5\"><a href=\"#fn-5\" class=\"footnote-ref\">5</a></sup>.</p>\n<p>Next we‚Äôre executing the actual synchonisation script with <code class=\"language-text\">run: node ./webmentions/sync.js</code>. Notice that we‚Äôre also making the <code class=\"language-text\">WEBMENTIONS_IO_TOKEN</code> secret available as an environment variable. If you remember, the script needs that variable to make requests to webmention.io. The actual value of that variable is saved as an encrypted secret in our repository. Check out <a href=\"https://docs.github.com/en/actions/security-guides/encrypted-secrets\">this GitHub guide on how to add encrypted secrets to your repository</a>.</p>\n<p>At that point, the script will have fetched new webmentions and have written them to disk. Time to actually commit them to the repository. There is weirdly no reusabled action for this, so that step is just executing a couple of git commands. Also make sure to replace the committer‚Äôs name and e-mail with your credentials so that the commit is associated to your account. The final command will push new mentions to your repository or do nothing if there were no changes.</p>\n<p>Since I am depoying my site to GitHub pages with <a href=\"https://github.com/janmonschke/janmonschke.github.com/blob/dev/.github/workflows/gh-pages-deploy.yml\">another action workflow which is triggererd by pushes to <code class=\"language-text\">dev</code></a>, my site will automatically rebuild whenever there are new webmentions üéâ.</p>\n<h4>Using webhooks to sync webmentions on-demand</h4>\n<p>This step is also optional but I felt it was actually fun to implement. The webmention.io API has a feature where it calls a webhook when it has new webmentions for your site. This allows us to update webmentions whenever a new mention comes in (faster than just every 24 hours).</p>\n<p>The webhook fits in beautifully into the GitHub action workflow because GitHub workflows can be triggered by calling a webhook. So in theory we could tell the webmention.io API to call our GitHub webhook directly. Which would then in turn start the webmention synchronization workflow.</p>\n<p>There is only a tiny problem with that setup. The GitHub webhook needs to be called with specific headers. Those headers cannot be configured on webmention.io. In order to go around this issue, I decided to add a no-code tool in between those two entities.</p>\n<p>I went with <a href=\"https://pipedream.com\">pipedream.com</a> because I struggled to set up a webhook from <a href=\"https://ifttt.com/\">ifttt.com</a> to GitHub and there is no way to inspect outgoing requests. It‚Äôs possible to make this flow work with other no-code tools but since I‚Äôm already using pipedream for other automations, I opted for this one.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8e4203db9a2ecd77bfa62d9f44d396df/ad654/pipedream_trigger.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABY0lEQVQoz42S2W7cMAxF9f8f2Ndm4vGqxVqozbZ8A8nNdCYNkD4ccAMvIYrsl+og5gXLssA5ByklhOAt5pw3P+fcaillnOf5wr7vsNaAiJrPuDVQ2kI7gnG++UobyPUP2sD52GrWB1BIL9Taaiy0JVCIYIo2aJ9wGxYoFxF2wG8FfjsfUD5AuTTr0r/QVuDSDuEymPUJKQY4Z1GOA2hPKX8p5TX+jlKAs4BiFQwZUgjElKoW9uPAcZRGKf/H0QRPuLiBKUMw2mARElKu4EJiXgSU0m1I/YhK/GI//U/qhxifwLjQGO89bl2P37cO7/cBb+93TDOHsa4tvFptKnX5l19zV/7K1UtYKYJxZbCMM+7jhH6YMEwLun6EWs0lqO2j+VnAWHoMaUONhTQExqXBPExN8O3WoR9nOPKt2Tr6Eaqn5ANCiFAugInVQgl53Z5asda7e2qo4s8C7otgyhvytj12+AEbBwMnPu9z6wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8e4203db9a2ecd77bfa62d9f44d396df/507e6/pipedream_trigger.webp 200w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/28a80/pipedream_trigger.webp 400w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/8d2ea/pipedream_trigger.webp 800w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/68fc1/pipedream_trigger.webp 1200w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/43d96/pipedream_trigger.webp 1600w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/82a76/pipedream_trigger.webp 1766w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8e4203db9a2ecd77bfa62d9f44d396df/36ca5/pipedream_trigger.png 200w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/a3397/pipedream_trigger.png 400w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/a331c/pipedream_trigger.png 800w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/8537d/pipedream_trigger.png 1200w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/1a152/pipedream_trigger.png 1600w,\n/static/8e4203db9a2ecd77bfa62d9f44d396df/ad654/pipedream_trigger.png 1766w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8e4203db9a2ecd77bfa62d9f44d396df/a331c/pipedream_trigger.png\"\n            alt=\"Setting up a pipedream trigger\"\n            title=\"Setting up a pipedream trigger\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>There is no special setup required for this trigger. We only need the url so we can add it to our webmention.io settings page.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/81ae1d40a76b0d3be35c0d1a629ef8b2/79ae3/pipedream_trigger_url.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCElEQVQoz6WQyW6EMBBE+f9PQ4BASJwmN3YI2Ay28VqRzUAyOSYtPbWrVa42RNPnhmYmaGeC7bCgwvwZwhUiRikoJdgoRShn/0UklQLjB7iQUNq80FDqHflLB8/tPzHGInoyAfLkIBuDPzMuwQ8NIQ0OZc4ezhZC6lt7z84lmFAvJHZ2IIJzMNbCOYerCKEYxxHDMGCeZ0zThLZtsaxr0H3fY9/34LXW3gDuDPS1rivSNEVVVciyDGmSII5jJEkSdFEUyPP8npVlicfjAyPld/Ad6F+nlAIhJGz2r2iaBl3Xhe6XLcuCuq4D18x7/b/z978DcYqfn+y1X6C1Dhhj3ma+X/4r7Ar8AiOiagFjm56ZAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/81ae1d40a76b0d3be35c0d1a629ef8b2/507e6/pipedream_trigger_url.webp 200w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/28a80/pipedream_trigger_url.webp 400w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/8d2ea/pipedream_trigger_url.webp 800w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/68fc1/pipedream_trigger_url.webp 1200w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/43d96/pipedream_trigger_url.webp 1600w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/4dc4f/pipedream_trigger_url.webp 1748w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/81ae1d40a76b0d3be35c0d1a629ef8b2/36ca5/pipedream_trigger_url.png 200w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/a3397/pipedream_trigger_url.png 400w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/a331c/pipedream_trigger_url.png 800w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/8537d/pipedream_trigger_url.png 1200w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/1a152/pipedream_trigger_url.png 1600w,\n/static/81ae1d40a76b0d3be35c0d1a629ef8b2/79ae3/pipedream_trigger_url.png 1748w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/81ae1d40a76b0d3be35c0d1a629ef8b2/a331c/pipedream_trigger_url.png\"\n            alt=\"Pipedream provides a url for your webhook trigger\"\n            title=\"Pipedream provides a url for your webhook trigger\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>The trigger for our new pipedream workflow is an incoming HTTP request:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b73511fb7013a9bc07696da72fe35e74/f546c/webmention_io_webhooks.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABU0lEQVQoz32S66qCUBCFfeES+hElXehfb9FDlRFERXZRKzVNK/OyDmsOW4QuGz7GfZk1awa1yWSCwWCAXq+H0WiETqeD4XAIwzDQ7/fR7XbRaDSg63pFs9lEq9WSHNJutyWOx2Noj8cD1+sVYRji9Xrh0yrL8iP1e66iKKDFcYz1eo3VaoXdbgfHcYTD4YDj8QjbtuH7PoIgkKi+L5eLGFFnhIa0JEmw3W5FlILqked58s3kLMuQ57lAFwo6q+95Lw43m41ANyzAs9vtJvF+v8s4oigSWESNqA7zWEBj4nK5FIeLxQKmaWI+n2M2m2E6ncpeRXXnuq50Y1kW9vu9wL04ZN9sj49YOU1TPJ/PKhK+ITxj+9+WOGTvrmPLHNkyxU+nk8zuV+I3tCwv4AYJzueziKhhk3+H6ZtIfV//bSpBL86qoStBrjCM4Hn+m8Anx0rwD2jH5iS2sP92AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/b73511fb7013a9bc07696da72fe35e74/507e6/webmention_io_webhooks.webp 200w,\n/static/b73511fb7013a9bc07696da72fe35e74/28a80/webmention_io_webhooks.webp 400w,\n/static/b73511fb7013a9bc07696da72fe35e74/8d2ea/webmention_io_webhooks.webp 800w,\n/static/b73511fb7013a9bc07696da72fe35e74/68fc1/webmention_io_webhooks.webp 1200w,\n/static/b73511fb7013a9bc07696da72fe35e74/43d96/webmention_io_webhooks.webp 1600w,\n/static/b73511fb7013a9bc07696da72fe35e74/a48fc/webmention_io_webhooks.webp 1634w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/b73511fb7013a9bc07696da72fe35e74/36ca5/webmention_io_webhooks.png 200w,\n/static/b73511fb7013a9bc07696da72fe35e74/a3397/webmention_io_webhooks.png 400w,\n/static/b73511fb7013a9bc07696da72fe35e74/a331c/webmention_io_webhooks.png 800w,\n/static/b73511fb7013a9bc07696da72fe35e74/8537d/webmention_io_webhooks.png 1200w,\n/static/b73511fb7013a9bc07696da72fe35e74/1a152/webmention_io_webhooks.png 1600w,\n/static/b73511fb7013a9bc07696da72fe35e74/f546c/webmention_io_webhooks.png 1634w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/b73511fb7013a9bc07696da72fe35e74/a331c/webmention_io_webhooks.png\"\n            alt=\"webmention.io settings screenshot showing the form to enter a webhook url\"\n            title=\"webmention.io settings screenshot showing the form to enter a webhook url\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>On the <a href=\"https://webmention.io/settings/webhooks\">webhooks settings page</a> you can then paste that URL and webmention.io will call it whenever there is a new webmention.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7851d2daf7c1c320d406249cf3a1d237/6c823/pipedream_step.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABg0lEQVQoz43SyW7bMBCAYb3/O/WUnPoAQWDHqWPLkSVxX7XZf0A5TZCD0R4+zoBDDghwqt5lhMt0JiBcwuYZk77ZNU4rm37Wvs7kGR0nSq/KxkxOkeA94zgAV7j+deF6vazxf5iQqcoihSCnxGVZmKfpyzLP616J8z8sy4LyiaoRlqa3nISj7i3HzqxK/i49jQr0JqJ9Xi/cU+pnFagOZ83v5xMPW8HjpuPXU8vDpuNx299sWp5qzVFF3mTkcFeiloFKek9nJa+NYn9WvJxKLvlz1rz3GmctWltiyuQ8kO7Iw4h0kapVirpr2HeOfWd4aQyvZ82u0dSdxpSGxq6XhnFkGH7Kq1tNukQllKE+1mzfTmz3Nc+7A3UraJVF6FszZSw+REJMK1+EWx7TQPx8obCRSmqHkQrnHNZajDHEEIgx4p3HWvdZcyjr0dbjfViFEBnHkalMxTzffrk1EZsndBjR8VsZ8mMrOXaKulUcOs2uj+xFRPoBHQZU4TOyTEAYOOvAByeW/VSjJzVHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7851d2daf7c1c320d406249cf3a1d237/507e6/pipedream_step.webp 200w,\n/static/7851d2daf7c1c320d406249cf3a1d237/28a80/pipedream_step.webp 400w,\n/static/7851d2daf7c1c320d406249cf3a1d237/8d2ea/pipedream_step.webp 800w,\n/static/7851d2daf7c1c320d406249cf3a1d237/68fc1/pipedream_step.webp 1200w,\n/static/7851d2daf7c1c320d406249cf3a1d237/43d96/pipedream_step.webp 1600w,\n/static/7851d2daf7c1c320d406249cf3a1d237/c072b/pipedream_step.webp 1876w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7851d2daf7c1c320d406249cf3a1d237/36ca5/pipedream_step.png 200w,\n/static/7851d2daf7c1c320d406249cf3a1d237/a3397/pipedream_step.png 400w,\n/static/7851d2daf7c1c320d406249cf3a1d237/a331c/pipedream_step.png 800w,\n/static/7851d2daf7c1c320d406249cf3a1d237/8537d/pipedream_step.png 1200w,\n/static/7851d2daf7c1c320d406249cf3a1d237/1a152/pipedream_step.png 1600w,\n/static/7851d2daf7c1c320d406249cf3a1d237/6c823/pipedream_step.png 1876w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7851d2daf7c1c320d406249cf3a1d237/a331c/pipedream_step.png\"\n            alt=\"Selecting an outgoing HTTP request as the next step in pipedream\"\n            title=\"Selecting an outgoing HTTP request as the next step in pipedream\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Back in our pipedream workflow, we can add a new HTTP request step:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8a354c4ed6e44e7acc57e12d4d141b30/d3a93/pipedream_step_http_post.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 53.5%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABmklEQVQoz5WSCW7bMBBFdf87tokt2dZqWRKX4foC0qnTFkGBCnjgzIic5ZPNeFdMq2LeNON6sCrHZgOb8WwmVB7GV37532ID8yE087yyLgv3dWWaJrz3pJSIMf4XpMSuhWbZDYe2rJtGG4cygpGA+Ih1Efkd/6dvXcCIR1uPKh3ulmZcHlyvN8ZpoR9G2u7Ktu8YazHGfq4GXdD6uVbbICK1O+Mis44s2tPcN8UwjBgrlVs/cDq3dJcrl+uNU9tVu+063t7e6boLbXfh3HYs9xXnA+I8zjk2ZWkO66qz7wc5Z0IItZPy+RJXmpCpwverYXeZnOtvUtkfY6XorqR0uCv6fmAYJ6wVnPOIc4i4WjnGVDeH+EVMz1iBnMg5ARldEs6Po2p47i5M81IPlDF8iFVwF54HcvokfyUrtoSE8QmJmUMCzbIpTqczP36+8X5qa/Lbra+6qTJuiLXrUuRvvA/cdWA4Av3umMotFyHLqNrYyqH0CyvuJbq48C3l3RbdY/DPd7hpqYFX1fCsXEZ23n8m+ze2TuDZjeMDlFVUylaO9csAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/8a354c4ed6e44e7acc57e12d4d141b30/507e6/pipedream_step_http_post.webp 200w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/28a80/pipedream_step_http_post.webp 400w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/8d2ea/pipedream_step_http_post.webp 800w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/68fc1/pipedream_step_http_post.webp 1200w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/43d96/pipedream_step_http_post.webp 1600w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/c97c6/pipedream_step_http_post.webp 1866w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/8a354c4ed6e44e7acc57e12d4d141b30/36ca5/pipedream_step_http_post.png 200w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/a3397/pipedream_step_http_post.png 400w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/a331c/pipedream_step_http_post.png 800w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/8537d/pipedream_step_http_post.png 1200w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/1a152/pipedream_step_http_post.png 1600w,\n/static/8a354c4ed6e44e7acc57e12d4d141b30/d3a93/pipedream_step_http_post.png 1866w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/8a354c4ed6e44e7acc57e12d4d141b30/a331c/pipedream_step_http_post.png\"\n            alt=\"Setting up the URL and body of the outgoing HTTP request\"\n            title=\"Setting up the URL and body of the outgoing HTTP request\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>The request should go to <code class=\"language-text\">api.github.com/YOUR_NAME/REPOSITORY.git/dispatches</code> (obv. replace with your own repository) and as its body it should send a simple JSON object that describes the type of event (will explain later). In our case, I called the event <code class=\"language-text\">webmention_webhook</code>.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 800px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7586cb566a10f898bce34dc746257da4/2de51/pipedream_step_http_post_headers.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 59.00000000000001%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAABx0lEQVQoz5WT6Y6jQAyEef9X3NkkhFxAoA/ou+FbNWSyo1ntj7FUspGs6nLZVO0w8RgUj1Fz7QTj7NE+o1z6EbRL9NpTdb1ASYnSGiklMUZyXkgp/wjrkpGzo3oqy2Qco5qZrWc2HucTPmZ8yHv+D1xIW6/xidkneuWo2kFyu91puyePtqe5XFFK45zDOrdnazEvvGtj8SGQc8aEzGAyzzlQDcrQdR3WFWWBtu2o6zOX623D6VWXhw7H06u+cG4uCCEJMRFCJIawj6xtIKfINM+s60pKCWctJcbJcx8NU4CcEsY6vsa6wrIs5GVhXRa0i1SDNrRtS/8cNoXOebwP27jGBayPCKm53R8IKXHeY+2nHX6H96zrwlQIn2rm3Fw51g2jkIxCvXMZqRs1j37k18eRurkilN7wt1dtDxbC2cfdw+JLIRyEZJoNeprfEJOhGwTH+szx1ND1T4RU//QVq4p9G2HTXLhc75tHLsR99C8YBsHhcKI+N3z8PnCqG5zf+6wPzGbfvJgs1ThZhmH3L6Zye5EQ47a5kst3UVA87Pqe+6PdVJarKBv2LwHljDbCIrNE+TsKyta+o2z/e3xut2BZ141w1JY/Nzec3pCtNncAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n          <source\n              srcset=\"/static/7586cb566a10f898bce34dc746257da4/507e6/pipedream_step_http_post_headers.webp 200w,\n/static/7586cb566a10f898bce34dc746257da4/28a80/pipedream_step_http_post_headers.webp 400w,\n/static/7586cb566a10f898bce34dc746257da4/8d2ea/pipedream_step_http_post_headers.webp 800w,\n/static/7586cb566a10f898bce34dc746257da4/68fc1/pipedream_step_http_post_headers.webp 1200w,\n/static/7586cb566a10f898bce34dc746257da4/43d96/pipedream_step_http_post_headers.webp 1600w,\n/static/7586cb566a10f898bce34dc746257da4/ab20a/pipedream_step_http_post_headers.webp 1848w\"\n              sizes=\"(max-width: 800px) 100vw, 800px\"\n              type=\"image/webp\"\n            />\n          <source\n            srcset=\"/static/7586cb566a10f898bce34dc746257da4/36ca5/pipedream_step_http_post_headers.png 200w,\n/static/7586cb566a10f898bce34dc746257da4/a3397/pipedream_step_http_post_headers.png 400w,\n/static/7586cb566a10f898bce34dc746257da4/a331c/pipedream_step_http_post_headers.png 800w,\n/static/7586cb566a10f898bce34dc746257da4/8537d/pipedream_step_http_post_headers.png 1200w,\n/static/7586cb566a10f898bce34dc746257da4/1a152/pipedream_step_http_post_headers.png 1600w,\n/static/7586cb566a10f898bce34dc746257da4/2de51/pipedream_step_http_post_headers.png 1848w\"\n            sizes=\"(max-width: 800px) 100vw, 800px\"\n            type=\"image/png\"\n          />\n          <img\n            class=\"gatsby-resp-image-image\"\n            src=\"/static/7586cb566a10f898bce34dc746257da4/a331c/pipedream_step_http_post_headers.png\"\n            alt=\"Setting up the HTTP headers for your outgoing HTTP request\"\n            title=\"Setting up the HTTP headers for your outgoing HTTP request\"\n            loading=\"lazy\"\n            decoding=\"async\"\n            style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n          />\n        </picture>\n  </a>\n    </span></p>\n<p>Next we add the required headers to the request. In <code class=\"language-text\">Authorization</code>, add your GitHub token (you can use the one we created earlier) and in <code class=\"language-text\">Accept</code> add <code class=\"language-text\">application/vnd.github+json</code>. This marks the workflow as complete and you can deploy it.</p>\n<p>The only thing that‚Äôs missing now is a change to our GitHub workflow. In our <code class=\"language-text\">on</code> list, we now add another entry <code class=\"language-text\">repository_dispatch</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">on</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span>\n    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">cron</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'0 */24 * * *'</span>\n  <span class=\"token key atrule\">workflow_dispatch</span><span class=\"token punctuation\">:</span>\n\n  <span class=\"token comment\"># pipedream webhook</span>\n  <span class=\"token key atrule\">repository_dispatch</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">types</span><span class=\"token punctuation\">:</span>\n      <span class=\"token punctuation\">-</span> webmention_webhook</code></pre></div>\n<p><code class=\"language-text\">repository_dispatch</code> enables webhooks for this workflow and <code class=\"language-text\">types: - webmention_webhook</code> sets up the flow to run on webhooks that have the event type <code class=\"language-text\">webmention_webhook</code> (which comes from the request body in our pipedream request).</p>\n<p>And that‚Äôs it. You can test out the whole flow by liking one of your toots / tweets that contain a URL to your own blog. Once brid.gy picks up the like (you can make it rescan that toot-/tweet-url) you should see that your GitHub workflow was triggered and your site is built again üéâ</p>\n<p>That‚Äôs really it.</p>\n<p>Unless.</p>\n<p>Well, in the rare case where you will have lots of likes, mentions and reposts for a blog post, you will now trigger a new pipeline run for every one of those webhook calls. This could result in git conflicts on the pipeline. Which in turn will potentially block the pipeline. It‚Äôs also not necessary to build your site 10 times within a minute. You can prevent multiple pipeline runs by adding the following to your workflow file:</p>\n<div class=\"gatsby-highlight\" data-language=\"yml\"><pre class=\"language-yml\"><code class=\"language-yml\"><span class=\"token key atrule\">concurrency</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> webmention_sync\n  <span class=\"token key atrule\">cancel-in-progress</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>This will stop previous pipelines when a new pipeline run is triggered. No more parallel pipeline runs, no more conflicts, yay üéâ</p>\n<p>This was really it, haha.</p>\n<h2>The end (my friend)</h2>\n<p>I hope this helps you to set up webmentions on your site. This post did get a little longer than I hoped, and documenting the process took way longer than actually building the integration. That is to say, it might look complicated, but it‚Äôs not as much work as it seems to be!</p>\n<p>Let me know how it worked out for you on your site by replying to <a href=\"https://social.lol/@janmon/109777627702072379\">this toot</a> or <a href=\"https://twitter.com/thedeftone/status/1620004702632169473\">this tweet</a>.</p>\n<div class=\"footnotes\">\n<hr>\n<ol>\n<li id=\"fn-1\">Check out this discussion on why Mastodon doesn‚Äôt currently support webmentions: <a href=\"https://github.com/mastodon/mastodon/issues/6074\">https://github.com/mastodon/mastodon/issues/6074</a><a href=\"#fnref-1\" class=\"footnote-backref\">‚Ü©</a></li>\n<li id=\"fn-2\">Brid.gy uses the standard Twitter search which does not return replies for tweets that are older than a couple of days: <a href=\"https://brid.gy/about#missing\">https://brid.gy/about#missing</a><a href=\"#fnref-2\" class=\"footnote-backref\">‚Ü©</a></li>\n<li id=\"fn-3\">Yes, I know about the debate over fetching in <code class=\"language-text\">useEffect</code>. That‚Äôs not the point of this example. I just wanted to provide a quick piece of code to showcase fetching webmentions on the client. üòÖ<a href=\"#fnref-3\" class=\"footnote-backref\">‚Ü©</a></li>\n<li id=\"fn-4\">This approach of enriching the text might not be 100% secure itself and it relies on the fact that <code class=\"language-text\">content.text</code> does not contain any HTML tags.<a href=\"#fnref-4\" class=\"footnote-backref\">‚Ü©</a></li>\n<li id=\"fn-5\">This discussion on GitHub shines some light on why another token is required: <a href=\"https://github.com/community/community/discussions/37103\">https://github.com/community/community/discussions/37103</a><a href=\"#fnref-5\" class=\"footnote-backref\">‚Ü©</a></li>\n</ol>\n</div>","frontmatter":{"title":"Adding webmentions to your static blog","type":"blog","date":"January 30, 2023","pomodoros":22,"keywords":["webmentions","gatsby","github actions","github workflow","webhook","webmentions.io"],"image":{"childImageSharp":{"gatsbyImageData":{"layout":"fixed","backgroundColor":"#d8a868","images":{"fallback":{"src":"/static/42e16455d593291331762856f5557ac3/a0679/webmentions_header_alternative.jpg","srcSet":"/static/42e16455d593291331762856f5557ac3/a0679/webmentions_header_alternative.jpg 800w","sizes":"800px"},"sources":[{"srcSet":"/static/42e16455d593291331762856f5557ac3/d6f15/webmentions_header_alternative.webp 800w","type":"image/webp","sizes":"800px"}]},"width":800,"height":420}}}}},"webmentions":{"edges":[{"node":{"id":"4d53f741-5a89-5c47-831d-d83932222924","author":{"name":"Jan","photo":"https://webmention.io/avatar/media.social.lol/94385a86d0a91df34c7b3f23d9433008ded38e5424efc65946b2e9fa4d288a77.jpg","url":"https://social.lol/@janmon"},"content":{"text":"Thanks to @andy and @sophie for the inspiration :)","html":"<p>Thanks to <span class=\"h-card\"><a href=\"https://bell.bz/@andy\" class=\"u-url\">@<span>andy</span></a></span> and <span class=\"h-card\"><a href=\"https://social.lol/@sophie\" class=\"u-url\">@<span>sophie</span></a></span> for the inspiration :)</p>"},"url":"https://social.lol/@janmon/109777631384556985","published":"2023/01/30 10:15"}},{"node":{"id":"f9dee21a-7843-553e-a67e-3744445a0f35","author":{"name":"Juhis","photo":"https://webmention.io/avatar/media.social.lol/4681b01a570ac17b6a3f8ec557578ff027e45fe9d79e5af6b39145bcece82dda.jpg","url":"https://mastodon.world/@hamatti"},"content":{"text":"@janmon This was a great read, thanks for writing it! I've been thinking about adding webmentions to my site for a long while now but I've been put off by so many moving pieces (and integrations).Maybe this week is the time I pick up that project!","html":"<p><span class=\"h-card\"><a href=\"https://social.lol/@janmon\" class=\"u-url\">@<span>janmon</span></a></span> This was a great read, thanks for writing it! I've been thinking about adding webmentions to my site for a long while now but I've been put off by so many moving pieces (and integrations).</p><p>Maybe this week is the time I pick up that project!</p>"},"url":"https://mastodon.world/@hamatti/109777741911560491","published":"2023/01/30 10:43"}},{"node":{"id":"232f75b3-cc5b-5515-8933-c297ceb0c7fb","author":{"name":"Esteban Torres","photo":"https://webmention.io/avatar/pbs.twimg.com/74583f80a05615213b01cf11d2d926ae624d42cf393f5072b508e09fd2fd9216.jpg","url":"https://twitter.com/esttorhe"},"content":{"text":"Ohhh. Nice work Jan. \n\nWill definitely try to tinker with this and try to add it to my own website","html":"Ohhh. Nice work Jan. \n\nWill definitely try to tinker with this and try to add it to my own website\n<a class=\"u-mention\" href=\"https://janmonschke.com/\"></a>\n<a class=\"u-mention\" href=\"https://twitter.com/thedeftone\"></a>"},"url":"https://twitter.com/esttorhe/status/1620014912834572288","published":"2023/01/30 11:03"}},{"node":{"id":"da05d56d-8716-5f81-86ac-2b6a60bc2d79","author":{"name":"Jan","photo":"https://webmention.io/avatar/media.social.lol/94385a86d0a91df34c7b3f23d9433008ded38e5424efc65946b2e9fa4d288a77.jpg","url":"https://social.lol/@janmon"},"content":{"text":"@hamatti Glad you liked it üéâGood luck with your integration. Let me know in case you hit any road blocks!","html":"<p><span class=\"h-card\"><a href=\"https://mastodon.world/@hamatti\" class=\"u-url\">@<span>hamatti</span></a></span> Glad you liked it üéâ</p><p>Good luck with your integration. Let me know in case you hit any road blocks!</p>"},"url":"https://social.lol/@janmon/109778389481723036","published":"2023/01/30 01:28"}},{"node":{"id":"974a18a4-7ea3-55b7-bc50-ee46facfec8b","author":{"name":"Jan Monschke (@janmon@social.lol)","photo":"https://webmention.io/avatar/pbs.twimg.com/ca3ad8e6d343c6d7b2069c6c885f79e0e2e53eaab61482b5a471a344cf7780a8.jpg","url":"https://twitter.com/thedeftone"},"content":{"text":"Yess, let me know how it goes!","html":"Yess, let me know how it goes!\n<a class=\"u-mention\" href=\"https://twitter.com/esttorhe\"></a>"},"url":"https://twitter.com/thedeftone/status/1620052183713718272","published":"2023/01/30 01:31"}},{"node":{"id":"cf77151d-e891-5cba-8f36-ad226aba7847","author":{"name":"Robb Knight :prami:","photo":"https://webmention.io/avatar/media.social.lol/d2b5943b2e687ef31399f8241bd07d88b1140716a89c5e026038eaf8ec5341b7.jpg","url":"https://social.lol/@robb"},"content":{"text":"@janmon Your post is what reminded me, I just saw it in my RSS!","html":"<p><span class=\"h-card\"><a href=\"https://social.lol/@janmon\" class=\"u-url\">@<span>janmon</span></a></span> Your post is what reminded me, I just saw it in my RSS!</p>"},"url":"https://social.lol/@robb/109779567016132895","published":"2023/01/30 06:27"}},{"node":{"id":"d578bb8b-d52c-5259-81e7-e5742c3ea9c7","author":{"name":"Jan","photo":"https://webmention.io/avatar/media.social.lol/94385a86d0a91df34c7b3f23d9433008ded38e5424efc65946b2e9fa4d288a77.jpg","url":"https://social.lol/@janmon"},"content":{"text":"@robb ü§©‚úåÔ∏è","html":"<p><span class=\"h-card\"><a href=\"https://social.lol/@robb\" class=\"u-url\">@<span>robb</span></a></span> ü§©‚úåÔ∏è</p>"},"url":"https://social.lol/@janmon/109779571523369368","published":"2023/01/30 06:28"}},{"node":{"id":"f5ba8d86-186b-548c-8723-60d4f51bdfa4","author":{"name":"trovster","photo":"https://webmention.io/avatar/pbs.twimg.com/9164cacb13a6a5ae179f52d1926a290f33a576fd782b65f017a6e17fd02a4891.jpg","url":"https://twitter.com/trovster"},"content":{"text":"üîó Adding webmentions to your static blog\n\n> Blogs are using webmentions to gather mentions/likes/reposts from all over the internet. Webmentions are a (recommended) standard that allows sites to notify other sites that they‚Äôre linking to them.\n\njanmonschke.com/adding-webment‚Ä¶","html":"üîó Adding webmentions to your static blog\n\n&gt; Blogs are using webmentions to gather mentions/likes/reposts from all over the internet. Webmentions are a (recommended) standard that allows sites to notify other sites that they‚Äôre linking to them.\n\n<a href=\"https://janmonschke.com/adding-webmentions-to-your-static-blog\">janmonschke.com/adding-webment‚Ä¶</a>\n<a class=\"u-mention\" href=\"https://janmonschke.com/adding-webmentions-to-your-static-blog/\"></a>"},"url":"https://twitter.com/trovster/status/1630994987742625801","published":"2023/03/01 06:14"}},{"node":{"id":"f36c5a4d-833a-5bd7-9bc7-c313b3c7fba2","author":{"name":"","photo":"","url":""},"content":null,"url":"https://rknight.me/adding-webmentions-to-your-site/","published":null}}]},"likes":{"edges":[{"node":{"author":{"name":"M√°rton Salomv√°ry","photo":"https://webmention.io/avatar/media.social.lol/87042648575d2aa2de2c2d66533c63431eec95a82ee47094bc6eb526ec39a356.jpg","url":"https://mastodon.berlin/@mrc"},"id":"0036188a-3d5c-5681-bf1b-e7d8fc7150b9"}},{"node":{"author":{"name":"Stefan Judis","photo":"https://webmention.io/avatar/pbs.twimg.com/2ba9a47d3ee6152babbedde03f3aa501709fa131fd662c70cfd9c4ee0aca30b6.jpg","url":"https://twitter.com/stefanjudis"},"id":"bf5c0ed9-ee33-5f93-859d-8a2f9661c8a4"}},{"node":{"author":{"name":"Esteban Torres","photo":"https://webmention.io/avatar/pbs.twimg.com/74583f80a05615213b01cf11d2d926ae624d42cf393f5072b508e09fd2fd9216.jpg","url":"https://twitter.com/esttorhe"},"id":"ae9dc76c-7657-5087-8d6b-c097ae383cc1"}},{"node":{"author":{"name":"Simon Hohl","photo":"https://webmention.io/avatar/media.social.lol/de3008fdb11a86c7ce704921c451ef3a6ca0f2ba652f29a9761c0462f20dde63.png","url":"https://home.social/@dersmon"},"id":"c616a52a-3590-5fb1-bd32-24a46bc663c2"}},{"node":{"author":{"name":"Andy Bell","photo":"https://webmention.io/avatar/media.social.lol/cea017ea6e66e1ee7d2f97f7278d83b1aa6a13ccb195c71c06a3e7b04d9bdfa0.jpg","url":"https://bell.bz/@andy"},"id":"04bbec7e-b5f7-5bfc-938b-f268b0fa97bf"}},{"node":{"author":{"name":"Henry","photo":"https://webmention.io/avatar/media.social.lol/2d3c63a237690d230a534d120e4ee48813a409195bf4cb061af204bc8d1fe63e.jpg","url":"https://social.lol/@hl"},"id":"cfac7340-2cca-54e5-85e9-162b88c13b73"}},{"node":{"author":{"name":"Rob Anderson","photo":"https://webmention.io/avatar/media.social.lol/58f0928fe136e8aa8a4bdf0861137158f95a762dfd999fe963bc947539523076.jpg","url":"https://hyem.tech/@rob"},"id":"0adcccf6-dad7-5a55-b1dc-69042e282eb9"}},{"node":{"author":{"name":"Michael Henriksen","photo":"https://webmention.io/avatar/media.social.lol/f3c773ff17ba197727fb1dafae3dd63977d55848ad3ad87df5d3d1710b085e3d.png","url":"https://chaos.social/@michenriksen"},"id":"afb7e28c-7592-5c3b-b1f8-b1d3294d9309"}},{"node":{"author":{"name":"üá∫üá¶ @gryzzly@mastodon.social","photo":"https://webmention.io/avatar/pbs.twimg.com/1cea001225e316fea0cd64321f597ce8c13088979442312bfe3f93b43137ea72.jpg","url":"https://twitter.com/gryzzly"},"id":"393aea24-cb41-5ccf-a5a8-c691bbcf62a5"}},{"node":{"author":{"name":"michele with one L","photo":"https://webmention.io/avatar/pbs.twimg.com/981eadca03f4d53b672c4ffd90e792c353e8071c4c82c63d09b7e965be1f7fc1.png","url":"https://twitter.com/sheley"},"id":"7c346f36-f1aa-5884-971d-632f4e02d434"}},{"node":{"author":{"name":"Guillaume Marty","photo":"https://webmention.io/avatar/media.social.lol/f880a3cb33e4e3e50b4041f60034eaf030c115c5bd4231ceff4a5ddb40eb688e.jpg","url":"https://indieweb.social/@gmarty"},"id":"3ecfba97-1e5a-5359-8a76-073ae8115f4e"}},{"node":{"author":{"name":"Romain Boulay","photo":"https://webmention.io/avatar/pbs.twimg.com/d12a3ebbc44128b69a7958ffa483d151740a49c7ecbe0f2b1ce9380be1485712.jpg","url":"https://twitter.com/r_boulay"},"id":"025c26dd-658f-5515-a15d-42b36e41edd4"}}]}},"pageContext":{"slug":"/adding-webmentions-to-your-static-blog","publicUrl":"https://janmonschke.com/adding-webmentions-to-your-static-blog/","previous":{"fields":{"slug":"/changing-my-online-identity"},"frontmatter":{"title":"Changing my online identity","type":"blog"}},"next":null}},"staticQueryHashes":["1677560032","3729604799"]}